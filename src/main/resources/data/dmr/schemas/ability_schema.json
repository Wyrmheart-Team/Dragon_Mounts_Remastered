{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "schemas/ability_schema.json",
  "$version": "1.0.0",
  "$comment": "This schema is used to validate dragon ability JSON files in the data/dmr/abilities directory. Each ability defines a special power or trait that can be assigned to dragon breeds.",
  "title": "Dragon Ability Schema",
  "description": "Schema for defining dragon abilities that can be assigned to dragon breeds",
  "type": "object",
  "oneOf": [
    {
      "type": "object",
      "properties": {
        "ability_type": {
          "type": "string",
          "enum": ["effect"],
          "description": "Specifies that this ability applies status effects to the dragon's owner. Uses GenericEffectAbility implementation."
        },
        "max_tier": {
          "type": "integer",
          "description": "Maximum tier level this ability can reach. Higher tiers typically provide stronger effects.",
          "minimum": 1,
          "default": 1,
          "examples": [3, 5]
        },
        "breed_transferable": {
          "type": "boolean",
          "description": "Whether the ability can be transferred to offspring when breeding dragons.",
          "default": false,
          "examples": [true, false]
        },
        "properties": {
          "type": "object",
          "description": "Properties specific to effect abilities.",
          "properties": {
            "range": {
              "type": "integer",
              "description": "Range in blocks for the ability effect.",
              "minimum": 0,
              "default": 10
            },
            "apply_to_dragon": {
              "type": "boolean",
              "description": "Whether to apply the effect to the dragon itself.",
              "default": true
            },
            "apply_to_owner": {
              "type": "boolean",
              "description": "Whether to apply the effect to the dragon's owner.",
              "default": false
            },
            "effects": {
              "type": "array",
              "description": "List of effects to apply (new format).",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "$ref": "definitions.json#/$defs/effect",
                    "description": "The status effect to apply."
                  },
                  "duration": {
                    "$ref": "definitions.json#/$defs/duration_integer",
                    "description": "Duration of the effect in ticks.",
                    "default": 40
                  },
                  "amplifier": {
                    "type": "integer",
                    "description": "Amplifier level of the effect (0 = level 1).",
                    "minimum": 0,
                    "default": 0
                  },
                  "ambient": {
                    "type": "boolean",
                    "description": "Whether the effect is ambient (from a beacon).",
                    "default": true
                  },
                  "show_particles": {
                    "type": "boolean",
                    "description": "Whether to show effect particles.",
                    "default": false
                  },
                  "show_icon": {
                    "type": "boolean",
                    "description": "Whether to show the effect icon.",
                    "default": true
                  },
                  "duration_scale_factor": {
                    "type": "number",
                    "description": "Factor by which the duration scales with ability tier.",
                    "minimum": 0,
                    "default": 1.0
                  },
                  "amplifier_scale_factor": {
                    "type": "number",
                    "description": "Factor by which the amplifier scales with ability tier.",
                    "minimum": 0,
                    "default": 0.0
                  }
                },
                "required": ["id"]
              }
            },
            "effect": {
              "$ref": "definitions.json#/$defs/effect",
              "description": "Single effect to apply (legacy format for backward compatibility)."
            },
            "duration": {
              "$ref": "definitions.json#/$defs/duration_integer",
              "description": "Duration of the effect in ticks (legacy format).",
              "default": 40
            },
            "amplifier": {
              "type": "integer",
              "description": "Amplifier level of the effect (legacy format).",
              "minimum": 0,
              "default": 0
            },
            "ambient": {
              "type": "boolean",
              "description": "Whether the effect is ambient (legacy format).",
              "default": true
            },
            "show_particles": {
              "type": "boolean",
              "description": "Whether to show effect particles (legacy format).",
              "default": false
            },
            "show_icon": {
              "type": "boolean",
              "description": "Whether to show the effect icon (legacy format).",
              "default": true
            },
            "duration_scale_factor": {
              "type": "number",
              "description": "Factor by which the duration scales with ability tier (legacy format).",
              "minimum": 0,
              "default": 1.0
            },
            "amplifier_scale_factor": {
              "type": "number",
              "description": "Factor by which the amplifier scales with ability tier (legacy format).",
              "minimum": 0,
              "default": 0.0
            }
          }
        }
      },
      "required": ["ability_type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "ability_type": {
          "type": "string",
          "enum": ["attribute"],
          "description": "Specifies that this ability modifies dragon attributes like health, speed, armor, etc."
        },
        "max_tier": {
          "type": "integer",
          "description": "Maximum tier level this ability can reach. Higher tiers typically provide stronger effects.",
          "minimum": 1,
          "default": 1,
          "examples": [3, 5]
        },
        "breed_transferable": {
          "type": "boolean",
          "description": "Whether the ability can be transferred to offspring when breeding dragons.",
          "default": false,
          "examples": [true, false]
        },
        "attributes": {
          "$ref": "definitions.json#/$defs/attributes",
          "description": "Attribute modifiers to apply to the dragon. Maps attribute IDs to their numeric values.",
          "examples": [
            {"minecraft:generic.max_health": 20.0, "minecraft:generic.movement_speed": 0.3}
          ]
        }
      },
      "required": ["ability_type", "attributes"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "ability_type": {
          "type": "string",
          "enum": ["aura"],
          "description": "Specifies that this ability applies effects to entities in an area around the dragon. Uses GenericAuraAbility implementation."
        },
        "max_tier": {
          "type": "integer",
          "description": "Maximum tier level this ability can reach. Higher tiers typically provide stronger effects.",
          "minimum": 1,
          "default": 1,
          "examples": [3, 5]
        },
        "breed_transferable": {
          "type": "boolean",
          "description": "Whether the ability can be transferred to offspring when breeding dragons.",
          "default": false,
          "examples": [true, false]
        },
        "properties": {
          "type": "object",
          "description": "Properties specific to aura abilities.",
          "properties": {
            "effect": {
              "$ref": "definitions.json#/$defs/effect",
              "description": "The status effect to apply to entities in the aura."
            },
            "duration": {
              "$ref": "definitions.json#/$defs/duration_integer",
              "description": "Duration of the effect in ticks.",
              "default": 40
            },
            "amplifier": {
              "type": "integer",
              "description": "Amplifier level of the effect (0 = level 1).",
              "minimum": 0,
              "default": 0
            },
            "radius": {
              "type": "integer",
              "description": "Radius in blocks for the aura effect.",
              "minimum": 0,
              "default": 5
            },
            "affect_owner": {
              "type": "boolean",
              "description": "Whether to apply the effect to the dragon's owner.",
              "default": false
            },
            "affect_allies": {
              "type": "boolean",
              "description": "Whether to apply the effect to allied entities.",
              "default": true
            },
            "affect_enemies": {
              "type": "boolean",
              "description": "Whether to apply the effect to enemy entities.",
              "default": false
            }
          },
          "required": ["effect"]
        }
      },
      "required": ["ability_type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "ability_type": {
          "type": "string",
          "enum": ["monster_aura"],
          "description": "Specifies that this ability affects nearby monsters or entities. Uses GenericMonsterAuraAbility implementation."
        },
        "max_tier": {
          "type": "integer",
          "description": "Maximum tier level this ability can reach. Higher tiers typically provide stronger effects.",
          "minimum": 1,
          "default": 1,
          "examples": [3, 5]
        },
        "breed_transferable": {
          "type": "boolean",
          "description": "Whether the ability can be transferred to offspring when breeding dragons.",
          "default": false,
          "examples": [true, false]
        },
        "properties": {
          "type": "object",
          "description": "Properties specific to monster aura abilities.",
          "properties": {
            "effect": {
              "$ref": "definitions.json#/$defs/effect",
              "description": "The status effect to apply to nearby monsters."
            },
            "duration": {
              "$ref": "definitions.json#/$defs/duration_integer",
              "description": "Duration of the effect in ticks.",
              "default": 40
            },
            "amplifier": {
              "type": "integer",
              "description": "Amplifier level of the effect (0 = level 1).",
              "minimum": 0,
              "default": 0
            },
            "range": {
              "type": "number",
              "description": "Range in blocks for the aura effect.",
              "minimum": 0,
              "default": 10.0
            },
            "ignore_line_of_sight": {
              "type": "boolean",
              "description": "Whether to ignore line of sight when targeting monsters.",
              "default": true
            },
            "fire_ticks": {
              "type": "integer",
              "description": "Number of fire ticks to apply to nearby monsters.",
              "minimum": 0,
              "default": 0
            },
            "requires_no_fire": {
              "type": "boolean",
              "description": "Whether the target must not be on fire for the effect to apply.",
              "default": false
            },
            "requires_not_fire_immune": {
              "type": "boolean",
              "description": "Whether the target must not be fire immune for the effect to apply.",
              "default": false
            },
            "requires_not_in_water_rain_or_bubble": {
              "type": "boolean",
              "description": "Whether the target must not be in water, rain, or bubble column for the effect to apply.",
              "default": false
            }
          }
        }
      },
      "required": ["ability_type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "ability_type": {
          "type": "string",
          "enum": ["conditional_effect"],
          "description": "Specifies that this ability applies status effects to the dragon and/or its owner when a specific condition is met. Uses GenericConditionalEffectAbility implementation."
        },
        "max_tier": {
          "type": "integer",
          "description": "Maximum tier level this ability can reach. Higher tiers typically provide stronger effects.",
          "minimum": 1,
          "default": 1,
          "examples": [3, 5]
        },
        "breed_transferable": {
          "type": "boolean",
          "description": "Whether the ability can be transferred to offspring when breeding dragons.",
          "default": false,
          "examples": [true, false]
        },
        "properties": {
          "type": "object",
          "description": "Properties specific to conditional effect abilities.",
          "properties": {
            "range": {
              "type": "integer",
              "description": "Range in blocks for the ability effect.",
              "minimum": 0,
              "default": 10
            },
            "apply_to_dragon": {
              "type": "boolean",
              "description": "Whether to apply the effect to the dragon itself.",
              "default": true
            },
            "apply_to_owner": {
              "type": "boolean",
              "description": "Whether to apply the effect to the dragon's owner.",
              "default": true
            },
            "condition_type": {
              "type": "string",
              "description": "The condition that must be met for the effect to apply.",
              "enum": ["none", "in_water", "near_nature"],
              "default": "none"
            },
            "nature_check_radius": {
              "type": "integer",
              "description": "Radius in blocks to check for nature blocks when condition_type is 'near_nature'.",
              "minimum": 0,
              "default": 2
            },
            "effects": {
              "type": "array",
              "description": "List of effects to apply when the condition is met.",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "$ref": "definitions.json#/$defs/effect",
                    "description": "The status effect to apply."
                  },
                  "duration": {
                    "$ref": "definitions.json#/$defs/duration_integer",
                    "description": "Duration of the effect in ticks.",
                    "default": 40
                  },
                  "amplifier": {
                    "type": "integer",
                    "description": "Amplifier level of the effect (0 = level 1).",
                    "minimum": 0,
                    "default": 0
                  },
                  "ambient": {
                    "type": "boolean",
                    "description": "Whether the effect is ambient (from a beacon).",
                    "default": true
                  },
                  "show_particles": {
                    "type": "boolean",
                    "description": "Whether to show effect particles.",
                    "default": false
                  },
                  "show_icon": {
                    "type": "boolean",
                    "description": "Whether to show the effect icon.",
                    "default": true
                  },
                  "duration_scale_factor": {
                    "type": "number",
                    "description": "Factor by which the duration scales with ability tier.",
                    "minimum": 0,
                    "default": 1.0
                  },
                  "amplifier_scale_factor": {
                    "type": "number",
                    "description": "Factor by which the amplifier scales with ability tier.",
                    "minimum": 0,
                    "default": 0.0
                  }
                },
                "required": ["id"]
              }
            }
          }
        }
      },
      "required": ["ability_type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "description": "Custom ability type - allows for any ability_type not covered by the predefined types above.",
      "properties": {
        "ability_type": {
          "$ref": "definitions.json#/$defs/identifier",
          "description": "Custom ability type identifier. This allows for extensibility beyond the predefined ability types."
        },
        "max_tier": {
          "type": "integer",
          "description": "Maximum tier level this ability can reach. Higher tiers typically provide stronger effects.",
          "minimum": 1,
          "default": 1,
          "examples": [3, 5]
        },
        "breed_transferable": {
          "type": "boolean",
          "description": "Whether the ability can be transferred to offspring when breeding dragons.",
          "default": false,
          "examples": [true, false]
        },
        "properties": {
          "type": "object",
          "description": "Properties specific to the custom ability type. The structure varies based on the ability_type value."
        },
        "attributes": {
          "$ref": "definitions.json#/$defs/attributes",
          "description": "Attribute modifiers to apply when the ability affects attributes. Maps attribute IDs to their numeric values."
        }
      },
      "required": ["ability_type"],
      "additionalProperties": true,
      "not": {
        "properties": {
          "ability_type": {
            "enum": ["effect", "attribute", "aura", "monster_aura", "conditional_effect"]
          }
        }
      }
    }
  ]
}
