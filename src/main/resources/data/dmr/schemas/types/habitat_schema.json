{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "schemas/types/habitat_schema.json",
  "$version": "1.0.0",
  "$comment": "This schema is used to define dragon habitats within breed JSON files. Habitats determine where dragons prefer to live, breed, and spawn. Each habitat type has different properties that affect how dragons interact with their environment.",
  "title": "Dragon Habitat Schema",
  "description": "Schema for defining dragon habitats that determine where dragons prefer to live and breed",
  "type": "object",
  "discriminator": {
    "propertyName": "type",
    "mapping": {
      "biome": "#/$defs/biome_habitat",
      "in_fluid": "#/$defs/fluid_habitat", 
      "world_height": "#/$defs/height_habitat",
      "light": "#/$defs/light_habitat",
      "nearby_blocks": "#/$defs/nearby_blocks_habitat",
      "dragon_breath": "#/$defs/dragon_breath_habitat",
      "time": "#/$defs/time_habitat",
      "picky": "#/$defs/picky_habitat"
    }
  },
  "oneOf": [
    {"$ref": "#/$defs/biome_habitat"},
    {"$ref": "#/$defs/fluid_habitat"},
    {"$ref": "#/$defs/height_habitat"},
    {"$ref": "#/$defs/light_habitat"},
    {"$ref": "#/$defs/nearby_blocks_habitat"},
    {"$ref": "#/$defs/dragon_breath_habitat"},
    {"$ref": "#/$defs/time_habitat"},
    {"$ref": "#/$defs/picky_habitat"}
  ],
  "$defs": {
    "biome_habitat": {
      "$anchor": "biome_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "biome",
          "description": "Specifies that this habitat is based on the biome the dragon is in."
        },
        "biome_tag": {
          "$ref": "../definitions/resources.json#/$defs/biome_tag",
          "description": "The biome tag that defines which biomes are suitable for this habitat. Dragons will prefer biomes that match this tag.",
          "examples": ["minecraft:is_mountain", "minecraft:is_end", "minecraft:is_nether"]
        },
        "points": {
          "type": "integer",
          "description": "The number of habitat points awarded when a dragon is in a matching biome. Higher values make the habitat more desirable.",
          "minimum": 0,
          "default": 3,
          "examples": [3, 5, 10]
        }
      },
      "required": ["type", "biome_tag"],
      "additionalProperties": false
    },
    "fluid_habitat": {
      "$anchor": "fluid_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "in_fluid",
          "description": "Specifies that this habitat is based on the fluid the dragon is in or near."
        },
        "fluid_tag": {
          "$ref": "../definitions/resources.json#/$defs/fluid_tag",
          "description": "The fluid tag that defines which fluids are suitable for this habitat. Dragons will prefer areas with fluids that match this tag.",
          "examples": ["minecraft:water", "minecraft:lava"]
        },
        "point_multiplier": {
          "type": "number",
          "description": "Multiplier applied to the base habitat points when the dragon is in the specified fluid. Values greater than 1.0 make the habitat more desirable.",
          "minimum": 0,
          "default": 1.0,
          "examples": [1.0, 2.0, 3.0]
        }
      },
      "required": ["type", "fluid_tag"],
      "additionalProperties": false
    },
    "height_habitat": {
      "$anchor": "height_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "world_height",
          "description": "Specifies that this habitat is based on the Y-coordinate (height) in the world."
        },
        "min_height": {
          "type": "integer",
          "description": "Minimum Y-coordinate where this habitat is suitable. Dragons below this height receive no habitat points.",
          "examples": [0, 64, 128]
        },
        "above_sea_level": {
          "type": "boolean",
          "description": "Whether the habitat requires the dragon to be above sea level (Y=64). Takes precedence over min_height if both are specified.",
          "default": false
        },
        "points": {
          "type": "integer",
          "description": "The number of habitat points awarded when the dragon is at a suitable height.",
          "minimum": 0,
          "default": 3,
          "examples": [3, 5, 10]
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "light_habitat": {
      "$anchor": "light_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "light",
          "description": "Specifies that this habitat is based on the light level at the dragon's location."
        },
        "min_light": {
          "type": "integer",
          "description": "Minimum light level required for this habitat. Light levels range from 0 (complete darkness) to 15 (bright sunlight).",
          "minimum": 0,
          "maximum": 15,
          "examples": [0, 7, 15]
        },
        "requires_sunlight": {
          "type": "boolean",
          "description": "Whether the habitat specifically requires natural sunlight (not artificial light sources like torches).",
          "default": false
        },
        "points": {
          "type": "integer",
          "description": "The number of habitat points awarded when the dragon is in suitable lighting conditions.",
          "minimum": 0,
          "default": 3,
          "examples": [3, 5, 10]
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "nearby_blocks_habitat": {
      "$anchor": "nearby_blocks_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "nearby_blocks",
          "description": "Specifies that this habitat is based on specific blocks in the vicinity of the dragon."
        },
        "block_tag": {
          "$ref": "../definitions/resources.json#/$defs/block_tag",
          "description": "The block tag that defines which blocks are suitable for this habitat. Dragons will prefer areas with blocks that match this tag.",
          "examples": ["minecraft:logs", "minecraft:leaves", "dmr:fire_dragon_habitat_blocks"]
        },
        "point_multiplier": {
          "type": "number",
          "description": "Multiplier applied based on the density of matching blocks nearby. Higher values make areas with more matching blocks more desirable.",
          "minimum": 0,
          "default": 1.0,
          "examples": [1.0, 2.0, 3.0]
        }
      },
      "required": ["type", "block_tag"],
      "additionalProperties": false
    },
    "dragon_breath_habitat": {
      "$anchor": "dragon_breath_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "dragon_breath",
          "description": "Specifies that this habitat is based on the presence of dragon breath particles in the area. Particularly useful for end dragons."
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "time_habitat": {
      "$anchor": "time_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "time",
          "description": "Specifies that this habitat is based on the time of day in the world."
        },
        "is_day": {
          "type": "boolean",
          "description": "Whether this habitat is suitable during day time. If true, dragons get habitat points during day. If false, dragons get points during night.",
          "examples": [true, false]
        },
        "points": {
          "type": "integer",
          "description": "The number of habitat points awarded when the time condition is met.",
          "minimum": 0,
          "default": 1,
          "examples": [1, 3, 5]
        }
      },
      "required": ["type"],
      "additionalProperties": false
    },
    "picky_habitat": {
      "$anchor": "picky_habitat",
      "type": "object",
      "properties": {
        "type": {
          "const": "picky",
          "description": "Specifies a compound habitat that requires multiple other habitat conditions to be satisfied simultaneously."
        },
        "required_habitats": {
          "type": "array",
          "description": "List of habitat conditions that must all be satisfied for this habitat to be valid. All conditions must be met (AND logic).",
          "items": {
            "$ref": "habitat_schema.json",
            "description": "A habitat definition that must be satisfied. If any required habitat returns 0 points, the entire picky habitat returns 0 points."
          },
          "minItems": 1,
          "examples": [
            [
              {"type": "in_fluid", "fluid_tag": "minecraft:lava", "point_multiplier": 3.0},
              {"type": "biome", "biome_tag": "minecraft:is_overworld", "points": 3}
            ]
          ]
        }
      },
      "required": ["type", "required_habitats"],
      "additionalProperties": false
    }
  }
}