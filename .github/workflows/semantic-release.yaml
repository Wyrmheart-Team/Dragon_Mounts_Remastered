name: Run semantic release

on:
  workflow_call:
    inputs:
      dry-run:
        description: 'Run semantic release in dry-run mode'
        required: false
        default: false
        type: boolean
    outputs:
      published:
        description: 'Whether a new release was published'
        value: ${{ jobs.semantic.outputs.published }}
      version:
        description: 'The new release version'
        value: ${{ jobs.semantic.outputs.version }}

jobs:
  semantic:
    name: Semantic Release
    runs-on: ubuntu-latest
    outputs:
      published: ${{ steps.rel.outputs.new_release_published }}
      version:   ${{ steps.rel.outputs.new_release_version }}
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      
      - name: Run Semantic Release
        id: rel
        uses: cycjimmy/semantic-release-action@v4
        with:
          dry_run: ${{ inputs.dry-run }}
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
      
      - name: Upload CHANGELOG.md as artifact
        uses: actions/upload-artifact@v4
        with:
          name: changelog-md
          path: CHANGELOG.md